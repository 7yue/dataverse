<div xmlns="http://www.w3.org/1999/xhtml"
     xmlns:h="http://java.sun.com/jsf/html"
     xmlns:f="http://java.sun.com/jsf/core"
     xmlns:ui="http://java.sun.com/jsf/facelets"
     xmlns:c="http://java.sun.com/jsp/jstl/core"
     xmlns:p="http://primefaces.org/ui"
     xmlns:o="http://omnifaces.org/ui">

    <!-- Search Form -->
    <p:panel styleClass="panelLayoutBlock panelSerchForm">

        <p:panelGrid styleClass="panelgridLayoutTable" columns="2" columnClasses="leftClass,rightClass">
            <ui:fragment>
                <h:form>
                    <p:focus/>
                    <!--autocomplete disabled for now, too buggy: https://redmine.hmdc.harvard.edu/issues/3447#note-2 -->
                    <!--<p:autoComplete id="autoCompleteSearch" size="40" value="SearchIncludeFragment.query" completeMethod="autoCompleteBean.complete" style="margin-right:1em;"/>-->
                    <p:inputText id="formerAutoCompleteSearch" size="40" value="#{SearchIncludeFragment.query}" style="margin-right:1em;"/>
                    <p:watermark for="formerAutoCompleteSearch" value="Search this Dataverse..."/>
                    <p:commandLink id="searchbutton" styleClass="btn btn-default" style="color:black;font-size:.9em;" action="#{SearchIncludeFragment.searchRedirect(dataverseLinksStayOnPage)}">
                        <span class="glyphicon glyphicon-search" style="margin-right:.3em;"/> Find
                    </p:commandLink>
                    <p:commandButton id="hiddensearchbutton" style="display: none" action="#{SearchIncludeFragment.searchRedirect(dataverseLinksStayOnPage)}"/>                       
                    <h:outputLink value="/search/advanced.xhtml" style="margin-left:1em;" rendered="#{showAdvancedSearchLink}">
                        <h:outputText value="Advanced Search"/>
                        <f:param name="q" value="#{SearchIncludeFragment.query}" disable="#{empty SearchIncludeFragment.query}"/>
                    </h:outputLink>

            <!--PUBLISHED/UNPUBLISHED TOGGLE-->
            <ui:fragment rendered="#{false and SearchIncludeFragment.userLoggedIn()}">
                <p:spacer width="10"/>
                <h:outputLink>
                    <h:outputText value="#{SearchIncludeFragment.PUBLISHED}" styleClass="btn #{SearchIncludeFragment.showUnpublished == false ? 'btn-primary' : 'btn-default'}"/>
                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                    </c:forEach>
                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                    <f:param name="page" value="1"/>
                </h:outputLink>
                <h:outputLink>
                    <!--<h:outputText value="#{SearchIncludeFragment.UNPUBLISHED}" style="#{SearchIncludeFragment.showUnpublished == true ? 'font-weight: bolder' : 'font-weight: normal'}"/>-->
                    <h:outputText value="#{SearchIncludeFragment.UNPUBLISHED}" styleClass="btn #{SearchIncludeFragment.showUnpublished == true ? 'btn-primary' : 'btn-default'}"/>
                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                    </c:forEach>
                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                    <f:param name="page" value="1"/>
                    <f:param name="unpublished" value="true"/>
                </h:outputLink>
            </ui:fragment>
                </h:form>
            </ui:fragment>

            <ui:fragment>
                <h:form id="shareForm" rendered="#{SearchIncludeFragment.allowedToClickAddData}" style="margin-left:auto;">
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle" style="font-size:.9em;" data-toggle="dropdown">
                            <span class="glyphicon glyphicon-plus" style="margin-right:.3em;"/> Add Data <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu pull-right" role="menu" style="text-align:left;">
                            <li><a href="/dataverse.xhtml?ownerId=#{SearchIncludeFragment.dataverse.id}">New Dataverse</a></li>
                            <li><a href="/dataset.xhtml?ownerId=#{SearchIncludeFragment.dataverse.id}">New Dataset</a></li>
                            <!--<li><a href="#" style="pointer-events: none; color: grey;">Existing Dataverse</a></li>-->
                            <!--<li><a href="#" style="pointer-events: none; color: grey;">Existing Dataset</a></li>-->
                        </ul>
                    </div>
                </h:form>
            </ui:fragment>
        </p:panelGrid>
    </p:panel>
    <!-- Search Results -->
    <p:panel>
        <ui:fragment rendered="#{!SearchIncludeFragment.solrIsDown}">
            <div style="width:20%;float:left;padding-right:1em;">

                <!--<div style="background:#E6F1F6;border:1px solid #DDDDDD;padding:.5em;margin-bottom:.5em;font-weight:bold;">Filter Your Results</div>-->

                <!--TYPE FACET (DATAVERSES, DATASETS, FILES)-->
                <h:form>
                    <!--DATAVERSE TOGGLE-->
                    <h:outputLink styleClass="facetLink #{SearchIncludeFragment.selectedTypesList.contains('dataverses') ? 'facetSelected': ''}" disabled="#{SearchIncludeFragment.getNewSelectedTypes('dataverses') == null}">
                        <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                        <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                        <f:param name="types" value="#{SearchIncludeFragment.getNewSelectedTypes('dataverses')}"/>
                        <!--<f:param name="fq#{SearchIncludeFragment.filterQueries.size()}" value="#{facetLabel.filterQuery}"/>-->
                        <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                            <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                        </c:forEach>
                        <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                        <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                        <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                        <f:param name="page" value="1"/>
                        <p:selectBooleanCheckbox value="#{SearchIncludeFragment.selectedTypesList.contains('dataverses') ? true : false}" disabled="#{SearchIncludeFragment.getNewSelectedTypes('dataverses') == null ? true : false}"/>
                        <!--<h:outputText styleClass="glyphicon glyphicon-remove" value="" rendered="#{SearchIncludeFragment.selectedTypesList.contains('dataverses')}"/>-->
                    </h:outputLink>
                    <!--DATAVERSES ONLY-->
                    <h:outputLink disabled="#{false}" style="text-decoration: none">
                        <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                        <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                        <f:param name="types" value="dataverses"/>
                        <!--<f:param name="fq#{SearchIncludeFragment.filterQueries.size()}" value="#{facetLabel.filterQuery}"/>-->
                        <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                            <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                        </c:forEach>
                        <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                        <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                        <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                        <f:param name="page" value="1"/>
                        <h:outputText style="padding:4px 0px 4px 30px; background: url(/resources/images/#{SearchIncludeFragment.selectedTypesList.contains('dataverses') ? 'icon_dataverse_dark.png' : 'icon_dataverse.png'}) no-repeat 4px 50% / 18px;"/>
                        <h:outputText value="Dataverses" style="color: #428BCA; font-weight: #{SearchIncludeFragment.selectedTypesList.contains('dataverses') ? 'bolder' : 'normal'}"/>
                        <h:outputText value=" (#{SearchIncludeFragment.facetCountDataverses})" style="color: #428BCA"/>
                    </h:outputLink>
                    <br/>
                    <!--DATASETS TOGGLE-->
                    <h:outputLink styleClass="facetLink #{SearchIncludeFragment.selectedTypesList.contains('datasets') ? 'facetSelected': ''}" disabled="#{SearchIncludeFragment.getNewSelectedTypes('datasets') == null}">
                        <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                        <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                        <f:param name="types" value="#{SearchIncludeFragment.getNewSelectedTypes('datasets')}"/>
                        <!--<f:param name="fq#{SearchIncludeFragment.filterQueries.size()}" value="#{facetLabel.filterQuery}"/>-->
                        <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                            <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                        </c:forEach>
                        <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                        <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                        <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                        <f:param name="page" value="1"/>
                        <p:selectBooleanCheckbox value="#{SearchIncludeFragment.selectedTypesList.contains('datasets') ? true : false}" disabled="#{SearchIncludeFragment.getNewSelectedTypes('datasets') == null ? true : false}"/>
                        <!--<h:outputText styleClass="glyphicon glyphicon-remove" value="" rendered="#{SearchIncludeFragment.selectedTypesList.contains('datasets')}"/>-->
                    </h:outputLink>
                    <!--DATASETS ONLY-->
                    <h:outputLink disabled="#{false}" style="text-decoration: none">
                        <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                        <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                        <f:param name="types" value="datasets"/>
                        <!--<f:param name="fq#{SearchIncludeFragment.filterQueries.size()}" value="#{facetLabel.filterQuery}"/>-->
                        <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                            <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                        </c:forEach>
                        <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                        <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                        <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                        <f:param name="page" value="1"/>
                        <h:outputText style="padding:4px 0px 4px 30px; background: url(/resources/images/#{SearchIncludeFragment.selectedTypesList.contains('datasets') ? 'icon_dataset_dark.png' : 'icon_dataset.png'}) no-repeat 4px 50% / 18px;"/>
                        <h:outputText value="Datasets" style="color: #428BCA; font-weight: #{SearchIncludeFragment.selectedTypesList.contains('datasets') ? 'bolder' : 'normal'}"/>
                        <h:outputText value=" (#{SearchIncludeFragment.facetCountDatasets})" style="color: #428BCA"/>
                    </h:outputLink>
                    <br/>
                    <!--FILES TOGGLE-->
                    <h:outputLink styleClass="facetLink #{SearchIncludeFragment.selectedTypesList.contains('files') ? 'facetSelected': ''}" disabled="#{SearchIncludeFragment.getNewSelectedTypes('files') == null}">
                        <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                        <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                        <!--<f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>-->
                        <f:param name="types" value="#{SearchIncludeFragment.getNewSelectedTypes('files')}"/>
                       <!--<f:param name="fq#{SearchIncludeFragment.filterQueries.size()}" value="#{facetLabel.filterQuery}"/>-->
                        <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                            <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                        </c:forEach>
                        <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                        <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                        <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                        <f:param name="page" value="1"/>
                        <p:selectBooleanCheckbox value="#{SearchIncludeFragment.selectedTypesList.contains('files') ? true : false}" disabled="#{SearchIncludeFragment.getNewSelectedTypes('files') == null ? true : false}"/>
                        <!--<h:outputText styleClass="glyphicon glyphicon-remove" value="" rendered="#{SearchIncludeFragment.selectedTypesList.contains('files')}"/>-->
                    </h:outputLink>
                    <!--FILES ONLY-->
                    <h:outputLink disabled="#{false}" style="text-decoration: none">
                        <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                        <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                        <!--<f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>-->
                        <f:param name="types" value="files"/>
                       <!--<f:param name="fq#{SearchIncludeFragment.filterQueries.size()}" value="#{facetLabel.filterQuery}"/>-->
                        <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                            <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                        </c:forEach>
                        <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                        <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                        <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                        <f:param name="page" value="1"/>
                        <h:outputText style="padding:4px 0px 4px 30px; background: url(/resources/images/#{SearchIncludeFragment.selectedTypesList.contains('files') ? 'icon_file_dark.png' : 'icon_file.png'}) no-repeat 4px 50% / 18px;"/>
                        <h:outputText value="Files" style="color: #428BCA; font-weight: #{SearchIncludeFragment.selectedTypesList.contains('files') ? 'bolder' : 'normal'}"/>
                        <h:outputText value=" (#{SearchIncludeFragment.facetCountFiles})" style="color: #428BCA"/>
                    </h:outputLink>
                </h:form>
                <p/>
                <!--NON-TYPE FACETS-->
                <ui:fragment rendered="#{SearchIncludeFragment.searchResultsCount > 0}">
                    <h:form>
                        <p:dataList id="facetCategoryList" value="#{SearchIncludeFragment.facetCategoryList}" var="facetCategory">
                            <h:outputText value="#{facetCategory.friendlyName}" styleClass="facetCategoryName"/>
                            <p:dataList value="#{facetCategory.facetLabel}" var="facetLabel" rows="#{SearchIncludeFragment.getNumberOfFacets(facetCategory.name,5)}">

                                <h:outputLink rendered="#{!SearchIncludeFragment.filterQueries.contains(facetLabel.filterQuery)}" styleClass="facetLink #{SearchIncludeFragment.filterQueries.contains(facetLabel.filterQuery) ? 'facetSelected' : ''}">
                                    <h:outputText value="#{facetLabel.name}"/>
                                    <h:outputText value=" (#{facetLabel.count})"/>
                                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                    <f:param name="fq#{SearchIncludeFragment.filterQueries.size()}" value="#{facetLabel.filterQuery}"/>
                                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                    </c:forEach>
                                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                    <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                </h:outputLink>

                                <h:outputLink rendered="#{SearchIncludeFragment.filterQueries.contains(facetLabel.filterQuery)}" styleClass="facetLink #{SearchIncludeFragment.filterQueries.contains(facetLabel.filterQuery) ?  'facetSelected' : ''}">
                                    <h:outputText value="#{facetLabel.name}" style="font-weight: bolder"/>
                                    <h:outputText value=" (#{facetLabel.count})"/>

                                    <h:outputText styleClass="glyphicon glyphicon-remove" value="" style="margin-left:.25em;"/>
                                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}' disable="#{clickedFilterQuery == facetLabel.filterQuery}"/>
                                    </c:forEach>
                                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                    <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                </h:outputLink>

                            </p:dataList>
                            <ui:fragment rendered="#{facetCategory.name != SearchIncludeFragment.searchFieldType and facetCategory.name != SearchIncludeFragment.searchFieldSubtree}">
                                <p:panelGrid styleClass="facetsMoreLess" columns="2" rendered="#{(SearchIncludeFragment.getNumberOfFacets(facetCategory.name,5) lt facetCategory.facetLabel.size()) or (SearchIncludeFragment.getNumberOfFacets(facetCategory.name,5) gt 5)}">
                                    <ui:fragment>
                                        <p:commandLink actionListener="#{SearchIncludeFragment.incrementFacets(facetCategory.name,-5)}" update="facetCategoryList" rendered="#{SearchIncludeFragment.getNumberOfFacets(facetCategory.name,5) gt 5}">Less...</p:commandLink>
                                    </ui:fragment>
                                    <ui:fragment>
                                        <p:commandLink actionListener="#{SearchIncludeFragment.incrementFacets(facetCategory.name,5)}" update="facetCategoryList" rendered="#{SearchIncludeFragment.getNumberOfFacets(facetCategory.name,5) lt facetCategory.facetLabel.size()}">More...</p:commandLink>
                                    </ui:fragment>  
                                </p:panelGrid>
                            </ui:fragment>
                        </p:dataList>
                    </h:form> 
                </ui:fragment>
            </div>
            <ui:param name="dataversePage" value="#{dataverseLinksStayOnPage == true ? '' : '/dataverse.xhtml' }"/>
            <div style="width:80%;float:left;">
                <!--DEBUG BEGIN-->
                <ui:fragment rendered="#{SearchIncludeFragment.debug}">
                    <div style="background-color: lightgray">
                        <tt>
                            <h:outputText value="searchResultsCount:#{SearchIncludeFragment.searchResultsCount}"/><br/>
                            <h:outputText value="totalPages:#{SearchIncludeFragment.totalPages}"/><br/>
                            <h:outputText value="paginationGuiRows:#{SearchIncludeFragment.paginationGuiRows}"/><br/>
                            <h:outputText value="paginationGuiStart:#{SearchIncludeFragment.paginationGuiStart}"/><br/>
                            <h:outputText value="paginationGuiEnd:#{SearchIncludeFragment.paginationGuiEnd}"/><br/>
                            <h:outputText value="showUnpublished:#{SearchIncludeFragment.showUnpublished} "/><br/>
                            <h:outputText value="mode:#{SearchIncludeFragment.mode} "/><br/>
                            <h:outputText value="sort=#{SearchIncludeFragment.sortField}:#{SearchIncludeFragment.sortOrder}"/><br/>
                            <h:outputText value="#{SearchIncludeFragment.filterQueriesDebug}"/><br/>
                        </tt>
                    </div>
                </ui:fragment>
                <!--DEBUG END-->

                <ui:fragment rendered="#{SearchIncludeFragment.searchResultsList.size() == 0}">
                    <div class="bg-warning" style="background:#FCF8F2; padding:.5em 1em;">
                        <!--<h:outputText value="We are in browse mode." rendered="#{SearchIncludeFragment.mode == SearchIncludeFragment.browseModeString}"/>
                        <h:outputText value="We are in search mode." rendered="#{SearchIncludeFragment.mode == SearchIncludeFragment.searchModeString}"/>-->
                        <ui:fragment rendered="#{SearchIncludeFragment.mode == SearchIncludeFragment.searchModeString}">
                            <!--<h4 class="text-warning" style="color:#F0AD4E;">THIS IS EMPTY / SEARCH</h4>-->
                            <p>Sorry, there are no Dataverses, Datasets, or Files that match your search. Please try a new search. You can also check out the <a href="/guides/User/find-use-data.html" target="_blank">search guide</a> for tips.</p>
                        </ui:fragment>
                        <ui:fragment rendered="#{dataverseSession.user.guest and SearchIncludeFragment.mode == SearchIncludeFragment.browseModeString}">
                            <!--<h4 class="text-warning" style="color:#F0AD4E;">THIS IS EMPTY / BROWSE / GUEST</h4>-->
                            <p>This Dataverse currently has no Dataverses, Datasets, or Files. Please <h:outputLink value="/loginpage.xhtml">log in</h:outputLink> to see if you are able to add to it.</p>
                        </ui:fragment>
                        <ui:fragment rendered="#{!dataverseSession.user.guest and !SearchIncludeFragment.allowedToClickAddData and SearchIncludeFragment.mode == SearchIncludeFragment.browseModeString}">
                            <!--<h4 class="text-warning" style="color:#F0AD4E;">THIS IS EMPTY / BROWSE / LOGGED IN / NO PERMS</h4>-->
                            <p>This Dataverse contains restricted Datasets you are not able to access.</p>
                        </ui:fragment>
                        <ui:fragment rendered="#{!dataverseSession.user.guest and SearchIncludeFragment.allowedToClickAddData and SearchIncludeFragment.mode == SearchIncludeFragment.browseModeString}">
                            <!--<h4 class="text-warning" style="color:#F0AD4E;">THIS IS EMPTY / BROWSE / LOGGED IN / PERMS</h4>-->
                            <p>This Dataverse currently has no Dataverses, Datasets, or Files. You can add to it by using the Add Data button on this page.</p>
                        </ui:fragment>
                    </div>
                </ui:fragment>
                <ui:fragment>
                    <ui:repeat value="#{SearchIncludeFragment.filterQueries}" var="filterQuery">
                        <ui:param name="friendlyNames" value="#{SearchIncludeFragment.getFriendlyNamesFromFilterQuery(filterQuery)}"/>
                        <h:outputLink styleClass="facetLink facetSelected resultsTopBlock" style="margin-right:1em;">
                            <h:outputText value="#{friendlyNames.get(0)}: #{friendlyNames.get(1)}"/>
                            <h:outputText styleClass="glyphicon glyphicon-remove" value=""/>
                            <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                            <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                            <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                <f:param name="fq#{status.index}" value='#{clickedFilterQuery}' disable="#{clickedFilterQuery == filterQuery}"/>
                            </c:forEach>
                            <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                            <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                            <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                            <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                        </h:outputLink>
                    </ui:repeat>

                    <ui:fragment rendered="#{SearchIncludeFragment.searchResultsCount > 0}">
                        <div id="resultsCountPaginatorBlock">
                            <!-- RESULTS COUNT -->
                            <div class="results-count pull-left">
                                <h:outputText value="#{SearchIncludeFragment.paginationGuiStart} to #{SearchIncludeFragment.paginationGuiEnd} of "/>
                                <h:outputText value="#{SearchIncludeFragment.searchResultsCount} "/>
                                <h:outputText value="#{SearchIncludeFragment.searchResultsCount == 1 ? 'result' : 'results'}"/>
                            </div>
                            <!-- SORT + PAGINATOR -->
                            <div class="results-sort-pagination pull-right">
                                <!-- PAGINATOR -->
                                <ui:fragment rendered="#{SearchIncludeFragment.totalPages != 1}">
                                    <o:importFunctions type="java.lang.Math" />
                                    <div class="pagination pull-right" style="margin-left:1em;">
                                        <ul class="pagination">
                                            <!--should take you to page 1-->
                                            <li>
                                                <h:outputLink>
                                                    <h:outputText value="&#171;"/>
                                                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                    </c:forEach>
                                                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                                    <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                    <f:param name="page" value="1"/>
                                                </h:outputLink>
                                            </li>
                                            <li>
                                                <h:outputLink>
                                                    <h:outputText value="&lt; Previous"/>
                                                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                    </c:forEach>
                                                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                                    <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                    <f:param name="page" value="#{Math:max(1,SearchIncludeFragment.page-1).intValue()}"/>
                                                </h:outputLink>
                                            </li>
                                            <c:forEach begin="#{Math:max(1,SearchIncludeFragment.page-Math:max(2,SearchIncludeFragment.page-SearchIncludeFragment.totalPages+4))}"
                                                       end="#{Math:min(SearchIncludeFragment.totalPages,SearchIncludeFragment.page+Math:max(2,5-SearchIncludeFragment.page))}"
                                                       var="pageListItem">
                                                <li class="#{SearchIncludeFragment.page == pageListItem ? 'active' : ''}">
                                                    <h:outputLink>
                                                        <h:outputText value="#{pageListItem}"/>
                                                        <span class="#{SearchIncludeFragment.page == pageListItem ? 'sr-only' : ''}">
                                                            <h:outputText value="#{SearchIncludeFragment.page == pageListItem ? ' (current)' : ''}"/>
                                                        </span>
                                                        <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                        <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                        <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                            <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                        </c:forEach>
                                                        <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                        <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                                        <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                                        <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                        <f:param name="page" value="#{pageListItem}"/>
                                                    </h:outputLink>
                                                </li>
                                            </c:forEach>
                                            <li>
                                                <h:outputLink>
                                                    <h:outputText value="Next &gt;"/>
                                                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                    </c:forEach>
                                                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                                    <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                    <f:param name="page" value="#{Math:min(SearchIncludeFragment.page+1,SearchIncludeFragment.totalPages).intValue()}"/>
                                                </h:outputLink>
                                            </li>
                                            <li>
                                                <h:outputLink>
                                                    <h:outputText value="&#187;"/>
                                                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                    </c:forEach>
                                                    <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                                    <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                                    <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                    <f:param name="page" value="#{SearchIncludeFragment.totalPages}"/>
                                                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                </h:outputLink>
                                            </li>
                                        </ul>
                                    </div>
                                </ui:fragment>
                                <!-- SORT BY -->
                                <div class="btn-group pull-right">
                                    <button type="button" class="btn btn-default dropdown-toggle" style="font-size:.9em;" data-toggle="dropdown">
                                        <span class="glyphicon glyphicon-sort" style="margin-right:.3em;"/> Sort <span class="caret"/>
                                    </button>
                                    <ul class="dropdown-menu pull-right" role="menu" style="text-align:left;">
                                        <li>
                                            <h:outputLink>
                                                <h:outputText value="Name (A-Z)" style="font-weight: #{SearchIncludeFragment.sortedByNameAsc ? 'bold' : 'normal'}"/>
                                                <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                    <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                </c:forEach>
                                                <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                <f:param name="page" value="1"/>
                                                <f:param name="sort" value="#{SearchIncludeFragment.searchFieldNameSort}"/>
                                                <f:param name="order" value="#{SearchIncludeFragment.ASCENDING}"/>
                                            </h:outputLink>
                                        </li>
                                        <li>
                                            <h:outputLink>
                                                <h:outputText value="Name (Z-A)" style="font-weight: #{SearchIncludeFragment.sortedByNameDesc ? 'bold' : 'normal'}"/>
                                                <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                    <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                </c:forEach>
                                                <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                <f:param name="page" value="1"/>
                                                <f:param name="sort" value="#{SearchIncludeFragment.searchFieldNameSort}"/>
                                                <f:param name="order" value="#{SearchIncludeFragment.DESCENDING}"/>
                                            </h:outputLink>
                                        </li>
                                        <li>
                                            <h:outputLink>
                                                <h:outputText value="Newest" style="font-weight: #{SearchIncludeFragment.sortedByReleaseDateDesc? 'bold' : 'normal'}"/>
                                                <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                    <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                </c:forEach>
                                                <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                <f:param name="page" value="1"/>
                                                <f:param name="sort" value="#{SearchIncludeFragment.searchFieldReleaseOrCreateDate}"/>
                                                <f:param name="order" value="#{SearchIncludeFragment.DESCENDING}"/>
                                            </h:outputLink>
                                        </li>
                                        <li>
                                            <h:outputLink>
                                                <h:outputText value="Oldest" style="font-weight: #{SearchIncludeFragment.sortedByReleaseDateAsc? 'bold' : 'normal'}"/>
                                                <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                    <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                </c:forEach>
                                                <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                <f:param name="page" value="1"/>
                                                <f:param name="sort" value="#{SearchIncludeFragment.searchFieldReleaseOrCreateDate}"/>
                                                <f:param name="order" value="#{SearchIncludeFragment.ASCENDING}"/>
                                            </h:outputLink>
                                        </li>
                                        <ui:fragment rendered="#{SearchIncludeFragment.mode == SearchIncludeFragment.searchModeString}">
                                            <li>
                                                <h:outputLink>
                                                    <h:outputText value="Relevance" style="font-weight: #{SearchIncludeFragment.sortedByRelevance ? 'bold' : 'normal'}"/>
                                                    <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                    <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                    <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                        <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                    </c:forEach>
                                                    <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                    <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                    <f:param name="page" value="1"/>
                                                    <f:param name="sort" value="#{SearchIncludeFragment.searchFieldRelevance}"/>
                                                    <f:param name="order" value="#{SearchIncludeFragment.DESCENDING}"/>
                                                </h:outputLink>
                                            </li>
                                        </ui:fragment>
                                        <!--<li><a href="#" class="ui-commandlink ui-widget" style="pointer-events: none; color: grey;">Release Date (#3628 #3629)</a></li>-->
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </ui:fragment>
                    <o:importFunctions type="org.omnifaces.el.functions.Strings" />
                    <ui:param name="descriptionAbbreviationThreshold" value="200"/>
                    <p:dataTable id="resultsTable" style="clear:left;" styleClass="#{SearchIncludeFragment.searchResultsCount > 0 ? '' : 'resultsNone'}" value="#{SearchIncludeFragment.searchResultsList}" var="result">
                        <p:column>
                            <ui:fragment rendered="#{result.type == 'dataverses'}">
                                <h:outputLink value="#{dataversePage}?id=#{result.entityId}" style="display:block; clear:left; margin-bottom: .5em;">
                                    <h:outputText value="#{result.name} Dataverse" style="padding:4px 0;" rendered="#{result.nameHighlightSnippet == null}"/>
                                    <h:outputText value="#{result.nameHighlightSnippet} Dataverse" style="padding:4px 0;" rendered="#{result.nameHighlightSnippet != null}" escape="false"/>
                                    <h:outputText value=" (#{result.status})" style="padding:4px 0;" rendered="#{SearchIncludeFragment.debug == true}"/>
                                </h:outputLink>
                                <div style="width:48px; float:left; margin:4px 12px 6px 0;">
                                    <img src="/resources/images/icon_dataverse.png" style="width:48px;" border="0" alt="Dataverse"/>
                                </div>

                                <h:outputText value="#{result.dataverseAffiliation}" rendered="#{result.dataverseAffiliation != null and result.dataverseAffiliationHighlightSnippet == null}" style="display:block; margin-bottom: .5em; color:#999999;"/>
                                <h:outputText value="#{result.dataverseAffiliationHighlightSnippet}" rendered="#{result.dataverseAffiliationHighlightSnippet != null}" style="display:block; margin-bottom: .5em; color:#999999;" escape="false"/>

                                <h:outputText value="#{Strings:abbreviate(result.descriptionNoSnippet, descriptionAbbreviationThreshold)}" rendered="#{result.descriptionSnippets.size() eq 0}"/>
                                <ui:fragment rendered="#{result.descriptionSnippets.size() gt 0}">
                                    <ui:repeat value="#{result.descriptionSnippets}" var="snippet" varStatus="varStatus">
                                        <h:outputText value="#{snippet}" escape="false"/>
                                        <h:outputText value="... " rendered="#{varStatus.last != true}"/>
                                    </ui:repeat>
                                </ui:fragment>
                                <ui:fragment rendered="#{false and result.matchedFields.size() > 0}">
                                    <h:outputText value="Found in Metadata Fields: "/>
                                    <ui:repeat value="#{result.matchedFields}" var="field" varStatus="varStatus">
                                        <h:outputText value="#{field}"/>
                                        <h:outputText value=", " rendered="#{varStatus.last != true}"/>
                                    </ui:repeat>
                                </ui:fragment>
                                <ui:fragment rendered="#{result.highlightsAsList.size() gt 0}">
                                    <ui:repeat value="#{result.highlightsAsList}" var="highlight">
                                        <ui:repeat value="#{highlight.snippets}" var="snippet">
                                            <br/>
                                            <ui:param value="#{highlight.solrField.nameFacetable}:intentional" name="unfriendly"/>
                                            <!--<h:outputText value="#{SearchIncludeFragment.getFriendlyNamesFromFilterQuery('name:intentional').get(0)}"/>-->
                                            <!--<h:outputText value="#{SearchIncludeFragment.getFriendlyNamesFromFilterQuery(unfriendly).get(0)}: "/>-->
                                            <h:outputText value="#{highlight.solrField.nameSearchable}: "/>
                                            <h:outputText value="#{snippet}" escape="false"/>
                                        </ui:repeat>
                                    </ui:repeat>
                                </ui:fragment>

                                <ui:fragment rendered="#{result.datasets.size() > 0}">
                                    <div style="clear:left;">

                                        <a data-toggle="collapse" data-parent="#accordion" href="#childDatasetBlock#{result.entityId}" value="javascript:void(0)">
                                            Preview Recently Released Datasets [+]
                                        </a>

                                        <div class="panel-collapse collapse" id="childDatasetBlock#{result.entityId}">
                                            <p:dataTable id="childDatasetTable" value="#{result.datasets}" var="dataset" rows="3" scrollable="true">
                                                <p:column headerText="Title" style="font-size: smaller; width: 90%">
                                                    <img src="/resources/images/icon_dataset.png" style="width:18px;margin:0 4px 0 0;vertical-align:bottom;" border="0" alt="Dataset" />
                                                    <h:outputLink value="/dataset.xhtml?id=#{dataset.id}">
                                                        <h:outputText value="#{dataset.getLatestVersion().getTitle()}" />
                                                    </h:outputLink>
                                                </p:column>
                                                <p:column headerText="Files" style="font-size: smaller; width: 10%; text-align: right">
                                                    <h:outputText value="#{dataset.getFiles().size()} #{dataset.getFiles().size() == 0 or dataset.getFiles().size() > 1 ? 'Files' : 'File'}" />
                                                </p:column>
                                                <f:facet name="footer">  
                                                    <h:outputLink value="#{dataversePage}?id=#{result.entityId}" style="font-weight:normal; font-size: smaller;">
                                                        <h:outputText value="View All Datasets and Dataverses &gt;"/>
                                                    </h:outputLink>
                                                </f:facet>
                                            </p:dataTable>
                                        </div>
                                    </div>
                                </ui:fragment>

                                <!--<div style="clear: left">
                                    <h:outputText value="### downloads + analysis"/>
                                </div>-->
                            </ui:fragment>
                            <ui:fragment rendered="#{result.type == 'datasets'}">
                                <h:outputLink value="/dataset.xhtml?id=#{result.entityId}" style="display:block; clear:left; margin-bottom: .5em;">
                                    <h:outputText value="#{result.title}" style="padding:4px 0;" rendered="#{result.titleHighlightSnippet == null}"/>
                                    <h:outputText value="#{result.titleHighlightSnippet}" style="padding:4px 0;" rendered="#{result.titleHighlightSnippet != null}" escape="false"/>
                                    <h:outputText value=" (#{result.status})" style="padding:4px 0;" rendered="#{SearchIncludeFragment.debug == true}"/>
                                </h:outputLink>
                                <div style="width:48px; float:left; margin:4px 12px 6px 0;">
                                    <!-- img src="/resources/images/icon_dataset.png" style="width:48px;" border="0" alt="Dataset"/ -->
                                    <p:graphicImage value="/api/access/dsPreview/#{result.entityId}"/>
                                </div>

                                <h:outputText value="#{result.citation}" styleClass="resultDatasetCitationBlock" rendered="#{result.citationHighlightSnippet == null}"/>
                                <h:outputText value="#{result.citationHighlightSnippet}" escape="false" styleClass="resultDatasetCitationBlock" rendered="#{result.citationHighlightSnippet != null}"/>

                                <h:outputText value="#{Strings:abbreviate(result.descriptionNoSnippet, descriptionAbbreviationThreshold)}" rendered="#{result.descriptionSnippets.size() eq 0}"/>
                                <ui:fragment rendered="#{result.descriptionSnippets.size() gt 0}">
                                    <ui:repeat value="#{result.descriptionSnippets}" var="snippet" varStatus="varStatus">
                                        <h:outputText value="#{snippet}" escape="false"/>
                                        <h:outputText value="... " rendered="#{varStatus.last != true}"/>
                                    </ui:repeat>
                                </ui:fragment>

                                <h:outputLink value="#{dataversePage}?id=#{result.parent.get('id')}" style="display:block;">
                                    <h:outputText value="Host Dataverse: #{result.parent.get('name')} Dataverse"/>
                                </h:outputLink>

                                <!--<div style="clear: left">
                                    <h:outputText value="### downloads + analysis"/>
                                </div>-->
                                <ui:fragment rendered="#{false and result.matchedFields.size() > 0}">
                                    <h:outputText value="Found in Metadata Fields: "/>
                                    <ui:repeat value="#{result.matchedFields}" var="field" varStatus="varStatus">
                                        <h:outputText value="#{field}"/>
                                        <h:outputText value=", " rendered="#{varStatus.last != true}"/>
                                    </ui:repeat>
                                </ui:fragment>
                                <ui:fragment rendered="#{result.highlightsAsList.size() > 0}">
                                    <ui:repeat value="#{result.highlightsAsList}" var="highlight">
                                        <ui:repeat value="#{highlight.snippets}" var="snippet">
                                            <br/>
                                            <!--<ui:param value="#{highlight.solrField.nameFacetable}:intentional" name="unfriendly"/>-->
                                            <!--<h:outputText value="#{SearchIncludeFragment.getFriendlyNamesFromFilterQuery('name:intentional').get(0)}"/>-->
                                            <!--<h:outputText value="#{SearchIncludeFragment.getFriendlyNamesFromFilterQuery(unfriendly).get(0)}: "/>-->
                                            <h:outputText value="#{highlight.displayName}: "/>
                                            <h:outputText value="#{snippet}" escape="false"/>
                                        </ui:repeat>
                                    </ui:repeat>
                                </ui:fragment>
                            </ui:fragment>

                            <ui:fragment rendered="#{result.type == 'files'}">
                                <!--FIXME: have a landing page for each file?-->
                                <h:outputLink value="/dataset.xhtml?id=#{result.parent.get('id')}" style="display:block; clear:left; margin-bottom: .5em;">
                                    <h:outputText value="#{result.name}" style="padding:4px 0;" rendered="#{result.nameHighlightSnippet == null}"/>
                                    <h:outputText value="#{result.nameHighlightSnippet}" style="padding:4px 0;" rendered="#{result.nameHighlightSnippet != null}" escape="false"/>
                                    <h:outputText value=" (#{result.status})" style="padding:4px 0;" rendered="#{SearchIncludeFragment.debug == true}"/>
                                </h:outputLink>
                                <div style="width:48px; float:left; margin:4px 12px 6px 0">
                                    <!-- img src="/resources/images/icon_file.png" style="width:48px;" border="0" alt="Data File"/ -->
                                    <p:graphicImage value="/api/access/preview/#{result.entityId}"/>
                                </div>

                                <h:outputText value="#{result.filetype}" style="display:block; margin-bottom: .5em; color:#999999;" rendered="#{result.fileTypeHighlightSnippet == null}"/>
                                <h:outputText value="#{result.fileTypeHighlightSnippet}" style="display:block; margin-bottom: .5em; color:#999999;" rendered="#{result.fileTypeHighlightSnippet != null}" escape="false"/>

                                <h:outputText value="#{Strings:abbreviate(result.descriptionNoSnippet, descriptionAbbreviationThreshold)}" rendered="#{result.descriptionSnippets.size() eq 0}"/>
                                <ui:fragment rendered="#{result.descriptionSnippets.size() gt 0}">
                                    <ui:repeat value="#{result.descriptionSnippets}" var="snippet" varStatus="varStatus">
                                        <h:outputText value="#{snippet}" escape="false"/>
                                        <h:outputText value="... " rendered="#{varStatus.last != true}"/>
                                    </ui:repeat>
                                </ui:fragment>

                                <h:outputLink value="/dataset.xhtml?id=#{result.parent.get('id')}" style="display:block;">
                                    <h:outputText value="Dataset: #{result.parent.get('name')}"/>
                                </h:outputLink>

                                <!--<h:outputText value="Description of file here"/><br/>-->
                                <!--<div style="clear:left;"> this needs to be a datatable-->
                                <!--<h:outputText value="Variable Label Title | Variable Value Title"/><br/>-->
                                <!--<h:outputText value="Label | Value"/><br/>-->
                                <!--<h:outputText value="Label | Value"/><br/>-->
                                <!--<h:outputText value="&#160;&#160;&#160;> View More"/>-->
                                <!--</div>-->
                                <!--<h:outputText value="* ## other data files from this dataset also match this keyword"/><br/>-->
                                <!--<div style="clear: left">
                                    <h:outputText value="### downloads + analysis"/>
                                </div>-->
                            </ui:fragment>
                        </p:column>

                    </p:dataTable>
                    <!-- BOTTOM PAGINATOR -->
                    <ui:fragment rendered="#{SearchIncludeFragment.totalPages != 1}">
                        <div class="results-sort-pagination pull-right">
                            <!-- PAGINATOR -->
                            <o:importFunctions type="java.lang.Math" />
                            <div class="pagination pull-right" style="margin-left:1em; margin-top: 0; margin-bottom: 0;">
                                <ul class="pagination" style="margin-top: 0; margin-bottom: 0;">
                                    <!--should take you to page 1-->
                                    <li>
                                        <h:outputLink>
                                            <h:outputText value="&#171;"/>
                                            <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                            <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                            <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                            </c:forEach>
                                            <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                            <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                            <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                            <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                            <f:param name="page" value="1"/>
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink>
                                            <h:outputText value="&lt; Previous"/>
                                            <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                            <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                            <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                            </c:forEach>
                                            <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                            <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                            <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                            <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                            <f:param name="page" value="#{Math:max(1,SearchIncludeFragment.page-1).intValue()}"/>
                                        </h:outputLink>
                                    </li>
                                    <c:forEach begin="#{Math:max(1,SearchIncludeFragment.page-Math:max(2,SearchIncludeFragment.page-SearchIncludeFragment.totalPages+4))}"
                                               end="#{Math:min(SearchIncludeFragment.totalPages,SearchIncludeFragment.page+Math:max(2,5-SearchIncludeFragment.page))}"
                                               var="pageListItem">
                                        <li class="#{SearchIncludeFragment.page == pageListItem ? 'active' : ''}">
                                            <h:outputLink>
                                                <h:outputText value="#{pageListItem}"/>
                                                <span class="#{SearchIncludeFragment.page == pageListItem ? 'sr-only' : ''}">
                                                    <h:outputText value="#{SearchIncludeFragment.page == pageListItem ? ' (current)' : ''}"/>
                                                </span>
                                                <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                                <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                                <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                    <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                                </c:forEach>
                                                <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                                <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                                <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                                <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                                <f:param name="page" value="#{pageListItem}"/>
                                            </h:outputLink>
                                        </li>
                                    </c:forEach>
                                    <li>
                                        <h:outputLink>
                                            <h:outputText value="Next &gt;"/>
                                            <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                            <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                            <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                            </c:forEach>
                                            <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                            <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                            <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                            <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                            <f:param name="page" value="#{Math:min(SearchIncludeFragment.page+1,SearchIncludeFragment.totalPages).intValue()}"/>
                                        </h:outputLink>
                                    </li>
                                    <li>
                                        <h:outputLink>
                                            <h:outputText value="&#187;"/>
                                            <f:param name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                                            <f:param name="q" value="#{SearchIncludeFragment.query}"/>
                                            <c:forEach items="#{SearchIncludeFragment.filterQueries}" var="clickedFilterQuery" varStatus="status">
                                                <f:param name="fq#{status.index}" value='#{clickedFilterQuery}'/>
                                            </c:forEach>
                                            <f:param name="sort" value="#{SearchIncludeFragment.sortField}"/>
                                            <f:param name="order" value="#{SearchIncludeFragment.sortOrder}"/>
                                            <f:param name="unpublished" value="true" disable="#{SearchIncludeFragment.showUnpublished == false}"/>
                                            <f:param name="page" value="#{SearchIncludeFragment.totalPages}"/>
                                            <f:param name="types" value="#{SearchIncludeFragment.selectedTypesString}"/>
                                        </h:outputLink>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </ui:fragment>
                </ui:fragment>
            </div>
            <div style="clear: left"/>
        </ui:fragment >
        <ui:fragment  rendered="#{SearchIncludeFragment.solrIsDown}">
            <p:dataTable value="#{SearchIncludeFragment.directChildDvObjectContainerList}" var="directChild">
                <p:column>
                    <ui:fragment rendered="#{directChild.class.simpleName == 'Dataverse'}">
                        <h:outputLink value="#{dataversePage}?id=#{directChild.id}" style="display:block; font-weight:bold; clear:left; margin-bottom: .5em;">
                            <h:outputText value="#{directChild.name} Dataverse" style="padding:4px 0;"/>
                        </h:outputLink>
                        <div style="width:48px; float:left; margin:4px 12px 6px 0;">
                            <img src="/resources/images/icon_dataverse.png" style="width:48px;" border="0" alt="Dataverse"/>
                        </div>

                        <h:outputText value="#{directChild.affiliation}" rendered="#{directChild.affiliation != null}" style="display:block; margin-bottom: .5em; color:#999999;"/>

                    </ui:fragment>
                    <ui:fragment rendered="#{directChild.class.simpleName == 'Dataset'}">
                        <h:outputLink value="/dataset.xhtml?id=#{directChild.id}" style="display:block; font-weight:bold; clear:left; margin-bottom: .5em;">
                            <h:outputText value="#{directChild}" style="padding:4px 0;"/>
                        </h:outputLink>
                        <div style="width:48px; float:left; margin:4px 12px 6px 0;">
                            <img src="/resources/images/icon_dataset.png" style="width:48px;" border="0" alt="Dataset"/>
                        </div>
                        <!--FIXME: copy more of the dataset card here from search.xhtml-->
                    </ui:fragment>
                </p:column>
            </p:dataTable>
            <h:outputText value="Please note: Due to an internal error, only a limited browsing experience is available (i.e. no facets)."/>
        </ui:fragment>
    </p:panel>
</div>
