<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <h:head>
    </h:head>

    <h:body>
        <ui:composition template="/dataverse_template.xhtml">
            <ui:param name="pageTitle" value="#{DataversePage.dataverse.name} Dataverse"/>
            <ui:param name="dataverse" value="#{DataversePage.dataverse}"/>
            <ui:param name="ownerId" value="#{DataversePage.ownerId}"/> 
            <ui:define name="body">        

                <f:metadata>
                    <f:viewParam name="id" value="#{DataversePage.dataverse.id}"/>
                    <f:viewParam name="ownerId" value="#{DataversePage.ownerId}"/>
                    <f:viewAction action="#{DataversePage.init}"/>
                    <f:viewParam name="id" value="#{SearchIncludeFragment.dataverseId}"/>
                    <f:viewParam name="q" value="#{SearchIncludeFragment.query}"/>
                    <f:viewParam name="fq1" value="#{SearchIncludeFragment.fq1}"/>
                    <f:viewParam name="fq0" value="#{SearchIncludeFragment.fq0}"/>
                    <f:viewParam name="fq2" value="#{SearchIncludeFragment.fq2}"/>
                    <f:viewParam name="fq3" value="#{SearchIncludeFragment.fq3}"/>
                    <f:viewParam name="fq4" value="#{SearchIncludeFragment.fq4}"/>
                    <f:viewParam name="fq5" value="#{SearchIncludeFragment.fq5}"/>
                    <f:viewParam name="fq6" value="#{SearchIncludeFragment.fq6}"/>
                    <f:viewParam name="fq7" value="#{SearchIncludeFragment.fq7}"/>
                    <f:viewParam name="fq8" value="#{SearchIncludeFragment.fq8}"/>
                    <f:viewParam name="fq9" value="#{SearchIncludeFragment.fq9}"/>
                    <f:viewAction action="#{SearchIncludeFragment.search()}" />
                </f:metadata>

                <h:form id="dataverseForm">
                    <!-- Name Panel -->
                    <p:panel styleClass="panelLayoutBlock">

                        <p:panelGrid styleClass="panelgridLayoutTable" columns="2" rendered="#{DataversePage.editMode}">
                            <p:panelGrid columns="2">
                                <ui:fragment>
                                    <p:inputText id="name" value="#{DataversePage.dataverse.name}"/>
                                    <p:outputLabel value=" Dataverse" for="name"/>
                                    <h:outputText value="*" style="color: #B94A48;"/>
                                    <p:watermark for="name" value="Enter name..."/>
                                </ui:fragment>
                                <p:message for="name"/>
                            </p:panelGrid>
                            <p:panelGrid columns="2" rendered="#{DataversePage.ownerId != null}">
                                <h:outputText value="Host Dataverse"/>
                                <p:selectOneMenu id="hostDataverse" value="#{DataversePage.ownerId}" filter="true" filterMatchMode="startsWith" effect="none">
                                    <f:selectItems value="#{dataverseServiceBean.findAll()}" var="dv" itemLabel="#{dv.name}" itemValue="#{dv.id}"
                                                   itemDisabled="#{dv eq DataversePage.dataverse or dv.owners.contains(DataversePage.dataverse)}"/>
                                </p:selectOneMenu>
                            </p:panelGrid>
                        </p:panelGrid>

                    </p:panel>

                    <!-- Info / Buttons Panel -->
                    <p:panel styleClass="panelLayoutBlock" rendered="#{(not empty DataversePage.owner 
																	    and permissionServiceBean.on(DataversePage.owner).canIssueCommand('RenameDataverseCommand'))
																		or DataversePage.editMode}">
                        <p:panelGrid styleClass="panelgridLayoutTable" columns="2" columnClasses="leftClass,rightClass">
                            <ui:fragment>
                                <p:panelGrid columns="2" styleClass="panelgridFormTable">
                                    <ui:fragment>
                                        <p:outputLabel value="Alias" for="alias"/> <h:outputText value="*" rendered="#{DataversePage.editMode}" style="color: #B94A48;"/>
                                    </ui:fragment>
                                    <ui:fragment>
                                        <h:outputText id="aliasOutput" value="#{DataversePage.dataverse.alias}" rendered="#{!DataversePage.editMode}"/>
                                        <p:panelGrid columns="2" rendered="#{DataversePage.editMode}">
                                            <p:inputText id="alias" value="#{DataversePage.dataverse.alias}"/>
                                            <p:message for="alias"/>
                                        </p:panelGrid>
                                    </ui:fragment>

                                    <ui:fragment>
                                        <p:outputLabel value="Contact E-mail" for="contactEmail"/> <h:outputText value="*" rendered="#{DataversePage.editMode}" style="color: #B94A48;"/>
                                    </ui:fragment>
                                    <ui:fragment>
                                        <h:outputText id="contactEmailOutput" value="#{DataversePage.dataverse.contactEmail}" rendered="#{!DataversePage.editMode}"/>
                                        <p:panelGrid columns="2" rendered="#{DataversePage.editMode}">
                                            <p:inputText id="contactEmail" value="#{DataversePage.dataverse.contactEmail}"/>
                                            <p:message for="contactEmail"/>
                                        </p:panelGrid>
                                    </ui:fragment>

                                    <p:outputLabel value="Affiliation" for="affiliation"/>
                                    <ui:fragment>
                                        <h:outputText id="affiliationOutput" value="#{DataversePage.dataverse.affiliation}" rendered="#{!DataversePage.editMode}"/>
                                        <p:panelGrid columns="2" rendered="#{DataversePage.editMode}">
                                            <p:inputText id="affiliation" value="#{DataversePage.dataverse.affiliation}"/>
                                            <p:message for="affiliation"/>
                                        </p:panelGrid>
                                    </ui:fragment>
                                </p:panelGrid>
                            </ui:fragment>

                            <ui:fragment rendered="#{!empty dataverseSession.user and !DataversePage.editMode}">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                      Edit Dataverse <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu" style="text-align:left;">
                                      <li>
                                          <p:commandLink id="editInfo" actionListener="#{DataversePage.edit}" update="@all">  
                                              <h:outputText value="General Information" />
                                          </p:commandLink>
                                      </li>
                                      <li>
                                          <h:link id="manageRoles" outcome="manage-roles">  
                                              <h:outputText value="Roles + Permissions" />
                                              <f:param name="dataverseId" value="#{DataversePage.dataverse.id}" />
                                              <f:param name="objectType" value="DATAVERSE" />
                                          </h:link>
                                      </li>
                                      <li><a href="#" style="pointer-events: none; color: grey;">Theme</a></li>
                                      <li><a href="#" style="pointer-events: none; color: grey;">Permissions</a></li>
                                    </ul>
                                </div>
                            </ui:fragment>
                        </p:panelGrid>
                    </p:panel>

                    <!-- Description Panel -->
                    <p:panel styleClass="panelLayoutBlock">
                        <p:panelGrid styleClass="panelgridLayoutTable" columns="2" columnClasses="leftClass,rightClass">
                            <ui:fragment>
                                <h:outputText value="#{DataversePage.dataverse.description}" rendered="#{!DataversePage.editMode}"/>
                                <p:panelGrid columns="3" styleClass="panelgridFormTable" rendered="#{DataversePage.editMode}">
                                    <p:outputLabel value="Description" for="description"/>
                                    <ui:fragment>
                                        <p:inputTextarea id="description" value="#{DataversePage.dataverse.description}"
                                                         rows="5" cols="50" counter="counter" maxlength="1000"
                                                         counterTemplate="{0} characters remaining" autoResize="false"/>
                                        <h:outputText id="counter" style="display:block;"/>
                                    </ui:fragment>
                                    <p:message for="description"/>
                                </p:panelGrid>
                            </ui:fragment>
                            <ui:fragment rendered="#{!DataversePage.editMode}">
                                &#160;
                            </ui:fragment>
                        </p:panelGrid>
                    </p:panel>

                    <!-- Create Dataverse Button Panel -->
                    <p:panel styleClass="panelLayoutButtonBlock" rendered="#{DataversePage.editMode}">
                        <p:commandButton id="save" value="#{DataversePage.dataverse.id == null ? 'Create Dataverse' : 'Save Changes'}" actionListener="#{DataversePage.save}" update="@all"/>
                        <p:commandButton id="cancel" value="Cancel" actionListener="#{DataversePage.cancel}" process="@this" update="@all" rendered="#{DataversePage.dataverse.id != null}"/>
                        <p:button value="Cancel" outcome="/dataverse.xhtml?id=#{DataversePage.ownerId}" rendered="#{DataversePage.dataverse.id == null and DataversePage.ownerId != null}"/>
                    </p:panel>
                </h:form>

                <!-- Search / Share Panel -->
                <p:panel styleClass="panelLayoutBlock" rendered="#{!DataversePage.editMode}">
                    <p:focus/>
                    <p:panelGrid styleClass="panelgridLayoutTable" columns="2" columnClasses="leftClass,rightClass">
                        <ui:fragment rendered="#{permissionServiceBean.on(DataversePage.dataverse).canIssueCommand('DatasetCreate')}">
                            <h:form id="shareForm" style="margin-left:auto;">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                                      Add Data <span class="caret"></span>
                                    </button>
                                    <ul class="dropdown-menu" role="menu">
                                      <li><a href="/dataverse.xhtml?ownerId=#{DataversePage.dataverse.id}">New Dataverse</a></li>
                                      <li><a href="/dataset.xhtml?ownerId=#{DataversePage.dataverse.id}">New Dataset</a></li>
                                      <li><a href="#" style="pointer-events: none; color: grey;">Existing Dataverse</a></li>
                                      <li><a href="#" style="pointer-events: none; color: grey;">Existing Dataset</a></li>
                                      <li><a href="#" style="pointer-events: none; color: grey;">New Query</a></li>
                                    </ul>
                                </div>
                            </h:form>
                        </ui:fragment>
                    </p:panelGrid>
                </p:panel>

                <!-- Content Panel -->
                <ui:fragment  rendered="#{!DataversePage.editMode}">
                    <ui:include src="search-include-fragment.xhtml">
                        <ui:param name="showAdvancedSearchLink" value="true"/>
                        <ui:param name="dataverseLinksStayOnPage" value="true"/>
                    </ui:include>
                </ui:fragment>
                <!--<p:panel styleClass="panelLayoutBlock dataverseChildren" rendered="{!DataversePage.editMode}" style="fon">-->
                    <!--<p:tree value="{DataversePage.treeWidgetRootNode}" var="node" id="tree" style="width:100%" >-->
                        <!--<p:treeNode id="treeNode">-->
                            <!--<h:outputLink value="/dataverse.xhtml?id={node.id}">-->
                                <!--<h:outputText value="{node.name} Dataverse" style="font-weight: {DataversePage.dataverse.id == node.id ? 'bold' : 'normal'}"/>-->
                            <!--</h:outputLink>-->
                        <!--</p:treeNode>-->
                    <!--</p:tree>-->
                <!--</p:panel>-->
            </ui:define>
        </ui:composition>        
    </h:body>
</html>
